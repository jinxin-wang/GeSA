### 1. Description of BQSR Module

the BQSR ( base quality socre recalibration ) is an important component for genomic data analysis , it detects systematic errors made by the sequencing machine when it estimates the accuracy of each base call .
The BQSR module aims to address these errors by recalibrating the base quality scores.
The recalibration process consist of two main steps:
First , the creation of a base quality score recalibration model and then the actual recalibration of base quality scores.
The model analyzes the characteristics of the sequenced data, such as the position in the read, the sequencing cycle, the sequence context, and other relevant features , Following that, it develops models of the patterns and error sources unique to the sequencing data. lastly , the recalibration model is applied to the entire dataset.

In the procedure known as base quality score recalibration (BQSR), machine learning is used to model these flaws empirically and modify the quality scores as necessary. 
For instance, we can determine that, for a given run, the following base we called had a 1% greater error rate whenever we called two A nucleotides in an a row. Therefore, the quality score of any base call that follows an AA in a read should be decreased by 1%. 
it is done over several different covariates (mainly sequence context and position in read, or cycle) in a way that is additive . So the same base may have its quality score increased for one reason and decreased for another. This allows us to get more accurate base qualities overall, which in turn improves the accuracy of our variant calls.

### 2. Description of Interfaces and Dependencies

1. remove duplicated reads
2. generate bam index with samtools
3. Base Quality Score Recalibration (BQSR) - first pass, GATK BaseRecalibrator
4. Base Quality Score Recalibration (BQSR) - first pass, GATK ApplyBQSR
5. reformat bam after Base Quality Score Recalibration (BQSR) - with samtools
6. generate bam index with samtools
7. Base Quality Score Recalibration (BQSR) - second pass, GATK BaseRecalibrator
8. analyse covariate BQSR - GATK AnalyzeCovariates

interfaces : 

1.input bam file : the bam file containing the aligned reads along with their associated base quality scores is required 

```
"bam/{sample}.bam"
```

2.Reference Genome : BQSR relies on the reference genome , it's a known sequence for aligning reads as well as identifying potential errors in base quality scores.

3.Known Variants: BQSR also relies and use a set of known variants derived from certain databases in order to estimate error rates and detect differences in the base quality scores.

4.Read Group Information : present in the bam file , used to improve the accuracy of the recaibration as it contains informations abou the sequencing platform , library preparation as well as other experimental details 

5.Output Recalibrated BAM file : at last the BQSR produce a recalibrated BAM file as output containing the original reads with updated base quality scores . this output is served laters as an input for variant calling algorithm

Dependencies :

1.Alignment Algorithm : the input BAM file is usually generated by aligning the sequencing reads to a reference genome using an alignement algorithm like BWA or Bowtie . As of that , to identidy the potential errors in the base quality scores ,  BQSR relies on the alignment information.

2.Variant Calling : to improve the accuracy of variant calling by applying BQSR to the input BAM file , it relies on the variant calling algorithm, such as GATK's HaplotypeCaller.

3.Reference Genome and known alignment : BQSR relies on a reference genome for aligning the reads and known variants for estimating error rates .The availability and quality of the reference genome and known variant dataset can impact the accuracy of BQSR.

4.Computational ressources : BQSR can be a computationally demanding method, particularly for NGS datasets of big size. The size of the input BAM file, the complexity of the reference genome, and the quantity of known variations all affect the execution time and resource needs.

Packages and versios :

The most commonly used package for performing Base Quality Score Recalibration (BQSR) is the Genome Analysis Toolkit (GATK).

GATK (Genome Analysis Toolkit) is a widely used software package developed by the Broad Institute for analyzing high-throughput sequencing data. 
Here the version used is GATK 4.1.4.1

SAMtools is a widely used set of command-line tools for manipulating SAM/BAM files, which are binary formats representing aligned sequencing reads
SAMtools provides an extensive toolkit for general SAM/BAM file manipulation .

The specific BQSR functionality in GATK is implemented in the following tools:

BaseRecalibrator: estimates the systematic errors in base quality scores by comparing the observed base mismatches with the expected errors. 
```
input:
        bam = "bam/{sample}.nodup.bam" 
        bai = "bam/{sample}.nodup.bam.bai" 
output:
        "BQSR/{sample}_BQSR_pass1.table"
```

GatherBqsrReports: used to gather the recalibration reports generated by the BaseRecalibrator tool. It combines the per-sample recalibration reports into a single file for downstream analysis.

ApplyBqsr: applies the recalibration tables generated by BaseRecalibrator to the input BAM file. It adjusts the base quality scores in the BAM file based on the recalibration information.

```
input:
        bam = "bam/{sample}.nodup.bam" 
        bai = "bam/{sample}.nodup.bam.bai" 
        recal_file = "BQSR/{sample}_BQSR_pass1.table"
output:
        temp("bam/{sample}.nodup.recal.beforeReformat.bam")
```




